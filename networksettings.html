<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Network Settings - Metal Brain</title>

  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/network.css">
</head>
<body>

  <!-- جلوگیری از ورود بدون لاگین -->
  <script type="module">
    import { requireAuth } from "./js/auth.js";
    requireAuth();
  </script>

  <div class="net-container">
    <header class="net-header">
      <button class="btn secondary back-btn" onclick="location.href='dashboard.html'">← Dashboard</button>
      <div>
        <h1>Network Settings</h1>
        <p>Full configuration for Access Point, Station, Security and Factory Reset.</p>
      </div>
    </header>

    <!-- آکاردئون‌ها -->
    <div class="accordion" data-section="ap">
      <button class="accordion-header">
        <span>Access Point</span>
        <span class="chevron">▼</span>
      </button>
      <div class="accordion-body">

        <!-- Wireless Security -->
        <fieldset class="group">
          <legend>WIRELESS SECURITY SETTINGS</legend>

          <div class="field">
            <label for="apSsid">SSID</label>
            <input id="apSsid" type="text" maxlength="32" placeholder="Metal Brain AP">
            <small class="hint">1–32 chars, not \"Metal Brain\".</small>
          </div>

          <div class="field">
            <label for="apKey">Pre-Shared Key</label>
            <input id="apKey" type="password" maxlength="64" placeholder="********">
            <small class="hint">8–64 characters.</small>
          </div>

          <div class="field-inline">
            <input id="apHidden" type="checkbox">
            <label for="apHidden">Hidden network (Hide SSID)</label>
          </div>
        </fieldset>

        <!-- More Settings 1 -->
        <fieldset class="group">
          <legend>MORE SETTINGS 1</legend>

          <div class="field-inline">
            <label>IP Version</label>
            <div class="radio-row">
              <label><input type="radio" name="ipMode" value="ipv4" checked> IPv4</label>
              <label><input type="radio" name="ipMode" value="ipv6"> IPv6</label>
            </div>
          </div>

          <div class="field">
            <label for="apHostname">Hostname</label>
            <input id="apHostname" type="text" maxlength="16" placeholder="ESP32-AP">
          </div>

          <div class="field">
            <label for="apIPv4">IPv4 Address</label>
            <input id="apIPv4" type="text" placeholder="192.168.1.2">
          </div>

          <div class="field">
            <label for="apIPv6">IPv6 Address</label>
            <input id="apIPv6" type="text" placeholder="xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx">
          </div>

          <div class="field">
            <label for="apPort">Port</label>
            <input id="apPort" type="number" min="0" max="65535" placeholder="8080">
          </div>
        </fieldset>

        <!-- More Settings 2 -->
        <fieldset class="group">
          <legend>MORE SETTINGS 2</legend>

          <div class="field">
            <label for="apChannel">WiFi Channel</label>
            <select id="apChannel">
              <option value="auto">Auto</option>
              <option value="1">1</option><option value="2">2</option>
              <option value="3">3</option><option value="4">4</option>
              <option value="5">5</option><option value="6">6</option>
              <option value="7">7</option><option value="8">8</option>
              <option value="9">9</option><option value="10">10</option>
              <option value="11">11</option><option value="12">12</option>
              <option value="13">13</option>
            </select>
          </div>

          <div class="field">
            <label for="apMaxConn">Max Connection</label>
            <select id="apMaxConn">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
            </select>
          </div>

          <div class="field">
            <label for="apMac">AP MAC</label>
            <input id="apMac" type="text" readonly>
          </div>
        </fieldset>

        <!-- More Settings 3 -->
        <fieldset class="group">
          <legend>MORE SETTINGS 3</legend>

          <div class="field">
            <label for="apGateway">Gateway</label>
            <input id="apGateway" type="text" placeholder="192.168.1.1">
          </div>

          <div class="field">
            <label for="apSubnet">Subnet</label>
            <input id="apSubnet" type="text" placeholder="255.255.255.0">
          </div>

          <div class="field">
            <label for="apDns1">DNS Primary</label>
            <input id="apDns1" type="text" placeholder="8.8.8.8">
          </div>

          <div class="field">
            <label for="apDns2">DNS Secondary</label>
            <input id="apDns2" type="text" placeholder="8.8.4.4">
          </div>
        </fieldset>

        <p id="apError" class="error-msg"></p>

        <div class="section-actions">
          <button class="btn secondary" id="apReadBtn">Read</button>
          <button class="btn primary" id="apSaveBtn">Save</button>
        </div>
      </div>
    </div>

    <!-- Station -->
    <div class="accordion" data-section="sta">
      <button class="accordion-header">
        <span>Station</span>
        <span class="chevron">▼</span>
      </button>
      <div class="accordion-body">

        <fieldset class="group">
          <legend>STATION SETTINGS</legend>

          <div class="field">
            <label for="staSsid">SSID</label>
            <input id="staSsid" type="text" maxlength="32">
          </div>

          <div class="field">
            <label for="staKey">Pre-Shared Key</label>
            <input id="staKey" type="password" maxlength="64">
          </div>

          <div class="field">
            <label for="staHost">Host Name</label>
            <input id="staHost" type="text" maxlength="16">
          </div>
        </fieldset>

        <fieldset class="group">
          <legend>READ-ONLY INFO</legend>

          <div class="field">
            <label for="staIp">IP Address</label>
            <input id="staIp" type="text" readonly>
          </div>

          <div class="field">
            <label for="staMac">STA MAC</label>
            <input id="staMac" type="text" readonly>
          </div>

          <div class="field">
            <label for="modemMac">Modem MAC</label>
            <input id="modemMac" type="text" readonly>
          </div>
        </fieldset>

        <p id="staError" class="error-msg"></p>

        <div class="section-actions">
          <button class="btn secondary" id="staReadBtn">Read</button>
          <button class="btn primary" id="staSaveBtn">Save</button>
        </div>
      </div>
    </div>

    <!-- Security -->
    <div class="accordion" data-section="sec">
      <button class="accordion-header">
        <span>Security</span>
        <span class="chevron">▼</span>
      </button>
      <div class="accordion-body">

        <fieldset class="group">
          <legend>LOGIN CREDENTIALS</legend>

          <div class="field">
            <label for="secUser">Username (1–16)</label>
            <input id="secUser" type="text" maxlength="16">
          </div>

          <div class="field">
            <label for="secPass">Password (1–16)</label>
            <input id="secPass" type="password" maxlength="16">
          </div>
        </fieldset>

        <p id="secError" class="error-msg"></p>

        <div class="section-actions">
          <button class="btn secondary" id="secReadBtn">Read</button>
          <button class="btn primary" id="secSaveBtn">Save</button>
        </div>
      </div>
    </div>

    <!-- Reset Factory -->
    <div class="accordion" data-section="reset">
      <button class="accordion-header">
        <span>Reset Factory</span>
        <span class="chevron">▼</span>
      </button>
      <div class="accordion-body reset-body">

        <p>Restore all network and security settings to factory defaults.</p>

        <div class="reset-wrap">
          <div class="reset-circle" id="resetCircle">
            <span id="resetCount">7</span>
          </div>
          <div class="reset-text">
            <p>Hold to start factory reset countdown.</p>
            <p class="hint">Command will be sent at <strong>5</strong>, device will reboot at <strong>0</strong>.</p>
          </div>
        </div>

        <button class="btn primary" id="resetBtn">Start Reset</button>
        <p id="resetError" class="error-msg"></p>
      </div>
    </div>

  </div>

  <script src="js/network.js"></script>
</body>
</html>
